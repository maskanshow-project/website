<template>
    <div class="container d-flex align-items-center justify-content-center">

        <div class="row col-8" dir="rtl">
            <div class="col-12 login-form">
                <form @submit.prevent="login">
                    <h2 class="text-center mb-4" :style="{ color: '#fff' }">ورود به سایت</h2>
                    <div class="alert alert-danger text-center" v-if="has_error">
                        متاسفانه اطلاعات ورودی به هم مطابقت ندارند :(    
                    </div>      
                    <div class="alert alert-danger text-center" v-if="invalid_code">
                        متاسفانه شما مجاز به استفاده از این حساب روی این سیستم نیستید
                    </div>      
                    <div class="form-group">
                        <input type="email" v-model="form.email" class="form-control" placeholder="آدرس ایمیل" required="required" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAmJJREFUWAntV7uKIkEUvbYGM4KID3wEIgjKRLLpKGLgFwiCfslGhkb7IbLgAzE1GhMxWxRRBEEwmEgDERWfW6fXuttq60a2wU6B1qlzb9U5fatsKROJVigUArvd7oeAyePx6Af3qGYymT7F2h8Wi+V7Pp+fmE7iv4Sw81GieusKIzNh4puCJzdaHIagCW1F4KSeQ4O4pPLoPb/3INBGBZ7avgz8fxWIxWIUCoX43Blegbe3NwoGg88zwMoncFUB8Yokj8dDdrv9MpfHVquV/H4/iVcpc1qgKAp5vV6y2WxaWhefreB0OimXy6kGkD0YDKhSqdB2u+XJqVSK4vE4QWS5XKrx0WjEcZ/PR9lslhwOh8p1Oh2q1Wp0OBw4RwvOKpBOp1kcSdivZPLvmxrjRCKhiiOOSmQyGXp5ecFQbRhLcRDRaJTe39//BHW+2cDr6ysFAoGrlEgkwpwWS1I7z+VykdvtliHuw+Ew40vABvb7Pf6hLuMk/rGY02ImBZC8dqv04lpOYjaw2WzUPZcB2WMPZet2u1cmZ7MZTSYTNWU+n9N4PJbp3GvXYPIE2ADG9Xqder2e+kTr9ZqazSa1222eA6FqtUoQwqHCuFgscgWQWC6XaTgcEiqKQ9poNOiegbNfwWq1olKppB6yW6cWVcDHbDarIuzuBBaLhWrqVvwy/6wCMnhLXMbR4wnvtX/F5VxdAzJoRH+2BUYItlotmk6nLGW4gX6/z+IAT9+CLwPPr8DprnZ2MIwaQBsV+DBKUEfnQ8EtFRdFneBDKWhCW8EVGbdUQfxESR6qKhaHBrSgCe3fbLTpPlS70M0AAAAASUVORK5CYII=&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%; cursor: auto;">
                    </div>
                    <div class="form-group">
                        <input type="password" v-model="form.password" class="form-control" placeholder="رمز عبور" required="required" style="background-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAmJJREFUWAntV7uKIkEUvbYGM4KID3wEIgjKRLLpKGLgFwiCfslGhkb7IbLgAzE1GhMxWxRRBEEwmEgDERWfW6fXuttq60a2wU6B1qlzb9U5fatsKROJVigUArvd7oeAyePx6Af3qGYymT7F2h8Wi+V7Pp+fmE7iv4Sw81GieusKIzNh4puCJzdaHIagCW1F4KSeQ4O4pPLoPb/3INBGBZ7avgz8fxWIxWIUCoX43Blegbe3NwoGg88zwMoncFUB8Yokj8dDdrv9MpfHVquV/H4/iVcpc1qgKAp5vV6y2WxaWhefreB0OimXy6kGkD0YDKhSqdB2u+XJqVSK4vE4QWS5XKrx0WjEcZ/PR9lslhwOh8p1Oh2q1Wp0OBw4RwvOKpBOp1kcSdivZPLvmxrjRCKhiiOOSmQyGXp5ecFQbRhLcRDRaJTe39//BHW+2cDr6ysFAoGrlEgkwpwWS1I7z+VykdvtliHuw+Ew40vABvb7Pf6hLuMk/rGY02ImBZC8dqv04lpOYjaw2WzUPZcB2WMPZet2u1cmZ7MZTSYTNWU+n9N4PJbp3GvXYPIE2ADG9Xqder2e+kTr9ZqazSa1222eA6FqtUoQwqHCuFgscgWQWC6XaTgcEiqKQ9poNOiegbNfwWq1olKppB6yW6cWVcDHbDarIuzuBBaLhWrqVvwy/6wCMnhLXMbR4wnvtX/F5VxdAzJoRH+2BUYItlotmk6nLGW4gX6/z+IAT9+CLwPPr8DprnZ2MIwaQBsV+DBKUEfnQ8EtFRdFneBDKWhCW8EVGbdUQfxESR6qKhaHBrSgCe3fbLTpPlS70M0AAAAASUVORK5CYII=&quot;); background-repeat: no-repeat; background-attachment: scroll; background-size: 16px 18px; background-position: 98% 50%; cursor: pointer;">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-block">ورود</button>
                    </div>
                    <!-- <div class="clearfix">
                        <label class="pull-left checkbox-inline"><input type="checkbox"> Remember me</label>
                        <a href="#" class="pull-right">Forgot Password?</a>
                    </div>         -->
                </form>
                <!-- <p class="text-center"><a href="#">Create an Account</a></p> -->
            </div>
        </div>

    </div>
</template>

<script>
export default {
    data() {
        return {
            has_error: false,
            invalid_code: false,

            form: {
                email: 'amirkhadangi920@owner.com',
                password: '123456'
            }
        }
    },
    mounted() {
        if ( localStorage.getItem('JWT') && localStorage.getItem('JWT') !== undefined )
            window.location.replace('/panel')
    },
    methods: {
        login() {
            axios({
                method: 'POST',
                url: '/graphql',
                headers: {
                    SystemAuthenticationCode: localStorage.getItem('SAC')
                },
                data: {
                    query: `mutation {
                        login(email: "${this.form.email}", password: "${this.form.password}") {
                            id
                            token
                            system_authentication_code
                            email
                        }
                    }`
                }
            })
            .then( ({data}) => {
                if ( data.status === 400 )
                {
                    this.has_error = true;
                    return console.log(data.message)
                }
                else if ( data.status === 403 )
                {
                    this.invalid_code = true;
                    return console.log(data.message)
                }
                
                this.has_error = false;
                localStorage.setItem('JWT', data.data.login.token)
                localStorage.setItem('SAC', data.data.login.system_authentication_code)
                window.location.replace('/panel')
            })
            .catch( (error) => {
                this.has_error = true;
                console.log(error)
            })
        }
    }
}
</script>

<style>
html, body, .container {
    height: 100%;
}
</style>
